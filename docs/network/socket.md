# Scoket
## 四元组
local ip, local port,remote ip,remote port

## client 最大连接数
因此本地端口个数最大只有65536，端口0有特殊含义，不能使用，这样可用端口最多只有65535

## server 最大连接数
不考虑ip地址分类等因素，
最大tcp连接数约为2的32次方（ip数）×2的16次方（port数），也就是server端单机最大tcp连接数约为2的48次方

### 实际
实际的tcp连接数

上面给出的是理论上的单机最大连接数，在实际环境中，受到机器资源、操作系统等的限制，特别是sever端，其最大并发tcp连接数远不能达到理论上限。

在unix/linux下限制连接数的主要因素是**内存和允许的文件描述符**个数（每个tcp连接都要占用一定内存，每个socket就是一个文件描述符），另外1024以下的端口通常为保留端口。在默认2.6内核配置下，经过试验，每个socket占用内存在15~20k之间。

说明对于一个进程而言 默认最多只能打开1024个文件，所以你要采用此默认配置最多也就可以并发上千个TCP连接。

### 精确
对mysql用户可同时打开文件数设置为10240个；
将Linux系统可同时打开文件数设置为1000000个（一定要大于对用户的同时打开文件数限制）；
将Linux系统对最大追踪的TCP连接数限制为20000个（但是，建议设置为10240；因为对mysql用户的同时打开文件数已经限制在10240个；且较小的值可以节省内存）；
将linux系统端口范围配置为1024～30000（可以支持60000个以上连接，不建议修改；默认已经支持20000个以上连接）；

 综合上述四点，TCP连接数限制在10140个。

这10240个文件中还得除去每个进程必然打开的标准输入，标准输出，标准错误，服务器监听 socket，进程间通讯的unix域socket等文件。